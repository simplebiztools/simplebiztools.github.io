<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpleBizTools - Essential Business Tools</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="auth-check.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>SimpleBizTools</h1>
            <p class="tagline">Essential tools for modern businesses</p>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h2>Simple. Powerful. Affordable.</h2>
            <p>Access our suite of business tools designed to save you time and money.</p>
        </section>

        <section class="tools-grid">
            <div class="tool-card">
                <h3>üìä Pricing Table Generator</h3>
                <p>Create beautiful, responsive pricing tables for your website in minutes.</p>
                <a href="pricing-generator.html" class="btn">Try it Free</a>
            </div>

            <div class="tool-card">
                <h3>üí∞ Meeting Cost Calculator</h3>
                <p>See the real-time cost of your meetings based on attendee salaries.</p>
                <a href="meeting-cost.html" class="btn">Calculate Now</a>
            </div>

            <div class="tool-card">
                <h3>üìù Changelog Hosting</h3>
                <p>Host and share your product updates with a clean, public changelog.</p>
                <a href="changelog.html" class="btn">Coming Soon</a>
            </div>

            <div class="tool-card">
                <h3>üí¨ Anonymous Feedback</h3>
                <p>Collect honest team feedback with our embeddable widget.</p>
                <a href="feedback.html" class="btn">Coming Soon</a>
            </div>

            <div class="tool-card">
                <h3>üåç Team Timezone Converter</h3>
                <p>See what time it is for your entire distributed team.</p>
                <a href="timezones.html" class="btn">View Tool</a>
            </div>

            <div class="tool-card premium">
                <h3>‚ö° Full Suite Access</h3>
                <p>Get unlimited access to all tools for one low price.</p>
                <p class="price">$39.99/month or $299 lifetime</p>
                <a href="#pricing" class="btn btn-premium">Get Started</a>
            </div>
        </section>

        <section id="pricing" class="pricing-section">
            <h2>Simple Pricing</h2>
            
            <!-- Login Required Notice -->
            <div id="login-notice" style="display: none; background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 30px; text-align: center;">
                <h3 style="color: #856404; margin-bottom: 10px;">üîí Account Required</h3>
                <p style="color: #856404; margin-bottom: 15px;">Please sign in or create an account to subscribe to a plan.</p>
                <a href="auth.html" style="display: inline-block; padding: 12px 30px; background: #667eea; color: white; text-decoration: none; border-radius: 6px; font-weight: 600;">Sign In / Create Account</a>
            </div>

            <!-- Email Match Warning (shown when logged in) -->
            <div id="email-warning" style="display: none; background: #e6f7ff; padding: 20px; border-radius: 8px; margin-bottom: 30px; text-align: center; border: 2px solid #1890ff;">
                <h3 style="color: #0050b3; margin-bottom: 10px;">‚ö†Ô∏è Important: Use Your Account Email with PayPal</h3>
                <p style="color: #0050b3; margin-bottom: 10px;">You're signed in as: <strong id="user-email-display"></strong></p>
                <p style="color: #0050b3; font-weight: bold;">Please use this SAME email when paying with PayPal to ensure instant access to your tools.</p>
            </div>

            <div class="pricing-options">
                <div class="pricing-card">
                    <h3>Individual Tools</h3>
                    <p class="price">$14.99<span>/month per tool</span></p>
                    <ul>
                        <li>Access to one tool</li>
                        <li>Unlimited usage</li>
                        <li>Email support</li>
                    </ul>
                    <div id="individual-paypal-container" style="margin-top: 20px; min-height: 150px;">
                        <!-- PayPal button will appear here when logged in -->
                    </div>
                </div>
                <div class="pricing-card featured">
                    <div class="badge">Best Value</div>
                    <h3>Full Suite</h3>
                    <p class="price">$39.99<span>/month</span></p>
                    <ul>
                        <li>All tools included</li>
                        <li>Unlimited usage</li>
                        <li>Priority support</li>
                        <li>Early access to new tools</li>
                    </ul>
                    <div id="fullsuite-paypal-container" style="margin-top: 20px; min-height: 150px;">
                        <!-- PayPal button will appear here when logged in -->
                    </div>
                </div>
                <div class="pricing-card">
                    <h3>Lifetime Deal</h3>
                    <p class="price">$299<span>one-time</span></p>
                    <ul>
                        <li>All tools forever</li>
                        <li>All future tools included</li>
                        <li>Unlimited usage</li>
                        <li>Premium support</li>
                    </ul>
                    <div id="lifetime-paypal-container" style="margin-top: 20px;">
                        <!-- PayPal button will appear here when logged in -->
                    </div>
                </div>
            </div>
        </section>

        <section id="contact" class="pricing-section" style="margin-top: 80px;">
            <h2>Contact Us</h2>
            <div style="max-width: 600px; margin: 40px auto; text-align: center; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.07);">
                <p style="color: #718096; font-size: 1.2em; margin-bottom: 30px;">Have questions? Need help? We're here for you!</p>
                <a href="mailto:SimpleBizTools101@gmail.com" style="display: inline-block; padding: 15px 40px; background: #667eea; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 1.1em;">üìß Email Us</a>
                <p style="color: #718096; margin-top: 20px;">SimpleBizTools101@gmail.com</p>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 SimpleBizTools. Built for businesses who value simplicity.</p>
        </div>
    </footer>

    <script src="https://www.paypal.com/sdk/js?client-id=AVT7yA-Ol5ZAxDc686NxPz-YI_ajoNpxJv4z3v1mCjUQBoWeNsTtCdkfX4gvtHoAUsH3iz4vxWxHWD-u&vault=true&intent=subscription" data-sdk-integration-source="button-factory"></script>
    <script>
        let buttonsRendered = false;

        // Use existing supabaseClient from auth-check.js
        // Check if user is logged in and show/hide PayPal buttons
        async function initializePricing() {
            if (buttonsRendered) {
                console.log('Buttons already rendered, skipping...');
                return;
            }
            
            console.log('Initializing pricing...');
            const { data: { session }, error } = await supabaseClient.auth.getSession();
            
            console.log('Session:', session);
            
            if (!session) {
                // Not logged in - show login notice
                console.log('Not logged in');
                document.getElementById('login-notice').style.display = 'block';
                document.getElementById('email-warning').style.display = 'none';
            } else {
                // Logged in - show email warning and PayPal buttons
                console.log('Logged in as:', session.user.email);
                document.getElementById('login-notice').style.display = 'none';
                document.getElementById('email-warning').style.display = 'block';
                document.getElementById('user-email-display').textContent = session.user.email;
                
                // Render PayPal buttons with pre-filled email
                console.log('Rendering PayPal buttons...');
                renderPayPalButtons(session.user.email);
                buttonsRendered = true;
            }
        }

        function renderPayPalButtons(userEmail) {
            console.log('Rendering buttons for:', userEmail);
            
            // Clear containers first
            document.getElementById('individual-paypal-container').innerHTML = '';
            document.getElementById('fullsuite-paypal-container').innerHTML = '';
            
            // Individual Tool Subscription Button ($14.99)
            paypal.Buttons({
                style: {
                    shape: 'pill',
                    color: 'gold',
                    layout: 'vertical',
                    label: 'subscribe'
                },
                createSubscription: function(data, actions) {
                    return actions.subscription.create({
                        plan_id: 'P-9M74147901295574ENEDFVNA',
                        subscriber: {
                            email_address: userEmail
                        }
                    });
                },
                onApprove: function(data, actions) {
                    alert('Thanks for subscribing! Your access will be activated shortly. Please check your email.');
                    window.location.reload();
                }
            }).render('#individual-paypal-container').then(() => {
                console.log('Individual button rendered');
            }).catch((err) => {
                console.error('Individual button error:', err);
            });

            // Full Suite Subscription Button ($39.99)
            paypal.Buttons({
                style: {
                    shape: 'pill',
                    color: 'gold',
                    layout: 'vertical',
                    label: 'subscribe'
                },
                createSubscription: function(data, actions) {
                    return actions.subscription.create({
                        plan_id: 'P-4TW04507V0019881ANEDEGUA',
                        subscriber: {
                            email_address: userEmail
                        }
                    });
                },
                onApprove: function(data, actions) {
                    alert('Thanks for subscribing! Your access will be activated shortly. Please check your email.');
                    window.location.reload();
                }
            }).render('#fullsuite-paypal-container').then(() => {
                console.log('Full suite button rendered');
            }).catch((err) => {
                console.error('Full suite button error:', err);
            });

            // Lifetime Deal Button ($299)
            const lifetimeContainer = document.getElementById('lifetime-paypal-container');
            lifetimeContainer.innerHTML = `
                <a href="https://www.paypal.com/ncp/payment/K53FU4G4SCYBN" 
                   class="btn btn-primary" 
                   target="_blank" 
                   style="display: inline-block; margin-top: 20px; padding: 15px 30px; background: #667eea; color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                   Buy Lifetime Access
                </a>
            `;
            console.log('Lifetime button rendered');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing...');
            setTimeout(initializePricing, 100);
        });

        // Also listen for auth state changes
        supabaseClient.auth.onAuthStateChange((event, session) => {
            console.log('Auth state changed:', event, session);
            if (event === 'SIGNED_IN' && !buttonsRendered) {
                setTimeout(initializePricing, 100);
            }
        });
    </script>
</body>
</html>
