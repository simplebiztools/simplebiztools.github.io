<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://tbrafvmlpridqosgrosy.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRicmFmdm1scHJpZHFvc2dyb3N5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMDI1MjMsImV4cCI6MjA3NzU3ODUyM30.rIh2mIEDKBJqmiV8Q3U71_YCYM-WJ_4xcdx_bcQw1NU';
        const { createClient } = supabase;
        const supabaseAuth = createClient(supabaseUrl, supabaseKey);

        function switchTab(tab) {
            // Update tabs
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('login-form').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('signup-form').classList.add('active');
            }
            
            // Clear messages
            hideMessages();
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            document.getElementById('success-message').classList.remove('show');
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.textContent = message;
            successDiv.classList.add('show');
            document.getElementById('error-message').classList.remove('show');
        }

        function hideMessages() {
            document.getElementById('error-message').classList.remove('show');
            document.getElementById('success-message').classList.remove('show');
        }

        async function signInWithGoogle() {
            hideMessages();
            try {
                const { data, error } = await supabaseAuth.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin + '/index.html'
                    }
                });
                
                if (error) throw error;
                
            } catch (error) {
                showError(error.message);
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            hideMessages();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const button = document.getElementById('login-button');
            
            button.disabled = true;
            button.textContent = 'Signing in...';
            
            try {
                const { data, error } = await supabaseAuth.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                showSuccess('Login successful! Redirecting...');
                setTimeout(() => {
                    window.location.href = 'index.html#pricing';
                }, 1500);
                
            } catch (error) {
                showError(error.message);
                button.disabled = false;
                button.textContent = 'Sign In';
            }
        }

        async function handleSignup(event) {
            event.preventDefault();
            hideMessages();
            
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const button = document.getElementById('signup-button');
            
            button.disabled = true;
            button.textContent = 'Creating account...';
            
            try {
                const { data, error } = await supabaseAuth.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: name
                        },
                        emailRedirectTo: window.location.origin + '/index.html#pricing'
                    }
                });
                
                if (error) throw error;
                
                showSuccess('Account created! Please check your email to verify your account, then you can subscribe to a plan.');
                document.getElementById('signup-form').reset();
                
            } catch (error) {
                showError(error.message);
            } finally {
                button.disabled = false;
                button.textContent = 'Create Account';
            }
        }

        // Check if already logged in
        supabaseAuth.auth.getSession().then(({ data: { session } }) => {
            if (session) {
                window.location.href = 'index.html#pricing';
            }
        });
    </script>
